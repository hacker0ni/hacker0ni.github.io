<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Using YARA" /><meta name="author" content="hacker0ni" /><meta property="og:locale" content="en" /><meta name="description" content="YARA is a multi-platform tool that lets you identify patterns in files. By identifying particular strings and signatures in a binary, you can determine the type of the file and gather a lot of information about it. It’s easy to use and customize for your own purposes. It’s mostly used in malware analysis." /><meta property="og:description" content="YARA is a multi-platform tool that lets you identify patterns in files. By identifying particular strings and signatures in a binary, you can determine the type of the file and gather a lot of information about it. It’s easy to use and customize for your own purposes. It’s mostly used in malware analysis." /><link rel="canonical" href="/posts/using-yara/" /><meta property="og:url" content="/posts/using-yara/" /><meta property="og:site_name" content="hacker0ni" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-10-15T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Using YARA" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@hacker0ni" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"hacker0ni"},"dateModified":"2022-02-16T03:39:50+00:00","datePublished":"2020-10-15T00:00:00+00:00","description":"YARA is a multi-platform tool that lets you identify patterns in files. By identifying particular strings and signatures in a binary, you can determine the type of the file and gather a lot of information about it. It’s easy to use and customize for your own purposes. It’s mostly used in malware analysis.","headline":"Using YARA","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/using-yara/"},"url":"/posts/using-yara/"}</script><title>Using YARA | hacker0ni</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="hacker0ni"><meta name="application-name" content="hacker0ni"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/icon.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">hacker0ni</a></div><div class="site-subtitle font-italic">Home of Mustafa B. Polat</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/hacker0ni" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/hacker0ni" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Using YARA</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Using YARA</h1><div class="post-meta text-muted"><div> By <em> <a href="https://linkedin.com/in/hacker0ni">Mustafa B. Polat</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1602720000" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2020-10-15 </em> </span> <span> Updated <em class="timeago" data-ts="1644982790" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-02-15 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="613 words"> <em>3 min</em> read</span></div></div></div><div class="post-content"><p><a href="https://github.com/VirusTotal/yara">YARA</a> is a multi-platform tool that lets you identify patterns in files. By identifying particular strings and signatures in a binary, you can determine the type of the file and gather a lot of information about it. It’s easy to use and customize for your own purposes. It’s mostly used in malware analysis.</p><p>Prerequisites:</p><ul><li>YARA from the linked GitHub page or apt-get<li>A portable executable to examine. Check out <a href="https://github.com/ytisf/theZoo">theZoo</a> for malware samples.<li>Text editor of your choice</ul><blockquote><p>You can find a lot of cool pre-written rules in <a href="https://github.com/Yara-Rules/rules">YaraRules Project’s Git</a>.</p></blockquote><p>After installing YARA on your computer/VM, you can simply create a file to write rules that dictate YARA what to look for in a binary. A YARA rule consists of 3 parts:</p><ul><li>meta<li>strings<li>condition</ul><p>Now let’s write a simple YARA rule that checks if the file is written for Windows systems. Windows executables contain the letters <code class="language-plaintext highlighter-rouge">MZ</code> at the first two bytes (or <code class="language-plaintext highlighter-rouge">4D 5A</code> in hex). These letters refer to Mark Zbikowski, who was a leading developer in MS-DOS. The first thing we need to do is to declare the rule with the <code class="language-plaintext highlighter-rouge">rule</code> keyword. Simply type it into the file.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>rule is_win_executable {
}
</pre></table></code></div></div><p>We’re going to insert the meta, strings and the condition into the curly brackets. Meta is, as the name suggests, information about the rule and what it does. Adding meta is not necessary. Now let’s add meta to give information about the rule.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>rule is_win_executable {
    meta :
        author = "dummysec"
        description = "Checks if the file is a Windows executable."
        version = "0.1"
}
</pre></table></code></div></div><p>Now let’s add the strings we want YARA to look for in the files. The string we’re looking for is <code class="language-plaintext highlighter-rouge">MZ</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>rule is_win_executable {
    meta :
        author = "dummysec"
        description = "Checks if the file is a Windows executable."
        version = "0.1"
    strings :
        $a = "MZ"
}
</pre></table></code></div></div><p>Lastly we need the condition to be set. We want YARA to look for the string “MZ” in the first two bytes.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>rule is_win_executable {
    meta :
        author = "dummysec"
        description = "Checks if the file is a Windows executable."
        version = "0.1"
    strings :
        $a= "MZ"
    condition :
        $a at 0
}
</pre></table></code></div></div><p>Our rule is ready to use! Make sure to save the file and we’ll open up a terminal to start looking for <code class="language-plaintext highlighter-rouge">MZ</code> in the first two bytes. You can use the following command to utilize the custom rule you’ve written:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yara -r custom_rule.yar ./file_dir
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">-r</code> flag specifies the rule and the last part specifies the location of the file on the disk. You can add multiple rules in a single rules file and YARA will look for all of them in a binary. You can add multiple strings and conditions with Boolean values to customize and fine tune your queries. By appending keywords like nocase to the strings, you can broaden your results. Finally, you can use question marks as <a href="https://en.wikipedia.org/wiki/Wildcard_character">wildcard characters</a>.</p><p>You may be asking yourself, why not use <code class="language-plaintext highlighter-rouge">xxd</code> to read the file and then pipe the results to grep? Grepping the xxd reading of a file is basically what YARA does. But with the custom rulesets and conditions set by the researcher, YARA proves useful by automating most of the stuff and saving time. Looking for known file signatures and functions can help you determine what the file is written for.</p><p>In the upcoming posts, we’ll take a look at fuzzy hashing and import hashing. Stay tuned!</p><p><em>Taken from our old blog over at hackerspot.net, written by me.</em></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/guides/'>Guides</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/siem-part-I/">Building Your Own Open-Source SIEM, Part I: AAAAAH!</a><li><a href="/posts/fim-osquery/">Implementing File Integrity Monitoring with Osquery</a><li><a href="/posts/linux-memory-forensics/">Linux Memory Forensics</a><li><a href="/posts/imphashing/">Import hashing (aka imphashes)</a><li><a href="/posts/using-yara/">Using YARA</a></ul></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/malware-lab/"><div class="card-body"> <em class="timeago small" data-ts="1624233600" > 2021-06-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building Your Own Dynamic Malware Analysis Lab</h3><div class="text-muted small"><p> Welcome back to my personal blog! In this blog post, I will introduce a couple of tools that you can use to analyze malware behavior at home. You will require a computer that can handle 2 virtual ...</p></div></div></a></div><div class="card"> <a href="/posts/fim-osquery/"><div class="card-body"> <em class="timeago small" data-ts="1645401600" > 2022-02-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Implementing File Integrity Monitoring with Osquery</h3><div class="text-muted small"><p> In this post I’d like to talk a bit about file integrity monitoring and how you can implement it using Osquery. Let’s jump in. Requirements: Osquery installation Basic understanding of the Li...</p></div></div></a></div><div class="card"> <a href="/posts/siem-part-I/"><div class="card-body"> <em class="timeago small" data-ts="1650240000" > 2022-04-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building Your Own Open-Source SIEM, Part I: AAAAAH!</h3><div class="text-muted small"><p> Intro This will be a post series where I discuss the details of an open-source SIEM and how you can deploy it on your own infrastructure. This will heavily focus on Security Onion 2 as it gives us ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/python-hash-vt/" class="btn btn-outline-primary" prompt="Older"><p>Python Script to Send a File Hash to VirusTotal</p></a> <a href="/posts/fuzzy-vs-regular-hashes/" class="btn btn-outline-primary" prompt="Newer"><p>Fuzzy Hashing vs Regular Hashing</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://linkedin.com/in/hacker0ni">Mustafa B. Polat</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-1N9MFZ196D"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-1N9MFZ196D'); }); </script>
